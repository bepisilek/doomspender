<!DOCTYPE html>
<html lang="hu" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Munka√≥ra ‚Äî Ap√°dhelyett Any√°d üòè</title>
<style>
:root {
  --bg-grad-1:#f7f9ff; --bg-grad-2:#eef2ff;
  --card:#ffffff; --text:#111827; --muted:#6b7280; --line:#e5e9f3;
  --blue:#0b66ff; --green:#22c55e; --red:#ef4444; --yellow:#facc15; --orange:#fb923c; --violet:#8b5cf6;
  --radius:20px; --shadow:0 10px 28px rgba(2,6,23,.08);
  --pill:#eaf0ff; --overlay:rgba(0,0,0,.5);
}
html[data-theme="dark"]{
  --bg-grad-1:#0b1020; --bg-grad-2:#0f1530;
  --card:#11172e; --text:#e9ecff; --muted:#aab2d6; --line:#283255;
  --shadow:0 16px 40px rgba(0,0,0,.45);
  --pill:#16234d; --overlay:rgba(0,0,0,.6);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--text);
  background:linear-gradient(180deg,var(--bg-grad-1),var(--bg-grad-2));
  display:flex; justify-content:center; align-items:stretch;
}
.container{width:100%;max-width:520px;padding:18px 14px 110px}
.hidden{display:none !important}
.center{text-align:center}
.pill{display:inline-flex;align-items:center;gap:6px;background:var(--pill);color:var(--text);padding:2px 8px;border-radius:999px;font-weight:700;font-size:11px}

/* Welcome */
#welcomeScreen{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}
.welcome-logo{font-size:72px;margin-bottom:16px;animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.welcome-title{font-size:42px;font-weight:900;margin:0 0 12px;background:linear-gradient(135deg,var(--blue),var(--violet));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.welcome-subtitle{font-size:16px;color:var(--muted);margin:0 0 28px;line-height:1.6;max-width:320px}
.welcome-btn{background:var(--blue);color:#fff;border:none;border-radius:16px;padding:15px 44px;font-size:18px;font-weight:800;cursor:pointer;box-shadow:0 12px 32px rgba(11,102,255,.35);transition:transform .2s,box-shadow .2s}
.welcome-btn:hover{transform:translateY(-2px);box-shadow:0 16px 40px rgba(11,102,255,.45)}

/* Profile setup */
#profileSetupScreen h1{font-size:30px;font-weight:900;margin:0 0 6px;text-align:center}
#profileSetupScreen .subtitle{font-size:13px;color:var(--muted);text-align:center;margin:0 0 18px}

/* Header & tabs */
.app-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.brand{display:flex;flex-direction:column}
.brand h1{font-size:26px;font-weight:900;letter-spacing:-.01em;margin:0}
.brand small{color:var(--muted);font-size:12px}
.header-right{display:flex;align-items:center;gap:10px}
.profile-icon{width:40px;height:40px;border-radius:50%;background:var(--blue);color:#fff;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:800;cursor:pointer}
.settings-btn{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--violet),var(--blue));color:#fff;border:none;font-size:18px;font-weight:900;cursor:pointer;box-shadow:0 8px 22px rgba(0,0,0,.18)}
.switch{display:flex;align-items:center;gap:6px}
.toggle{appearance:none;width:44px;height:24px;background:#cfd8ff44;border-radius:999px;position:relative;cursor:pointer;outline:none}
.toggle::after{content:"";position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.25);transition:left .18s}
.toggle:checked::after{left:23px}

.tabs{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin:10px 0 12px}
.tab{border:none;border-radius:13px;background:#eaf0ff66;color:var(--text);font-weight:800;font-size:13px;padding:10px 0;cursor:pointer;transition:transform .12s,box-shadow .2s}
.tab.active{background:var(--blue);color:#fff;box-shadow:0 10px 22px rgba(11,102,255,.25)}

/* Cards & forms */
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px 14px;margin-bottom:14px}
h2{margin:0 0 10px;text-align:center;color:var(--blue);font-size:18px}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input,select,textarea{width:100%;padding:11px 12px;border:1px solid var(--line);border-radius:12px;font-size:15px;background:transparent;color:var(--text)}
input:focus,select:focus,textarea:focus{border-color:var(--blue);outline:none;box-shadow:0 0 0 2px rgba(11,102,255,.15)}
.row{display:flex;gap:8px;margin-top:10px}
.btn{flex:1;border:none;border-radius:12px;padding:12px 0;font-size:14px;font-weight:900;color:#fff;cursor:pointer;transition:opacity .12s,transform .12s,box-shadow .2s}
.btn:hover{opacity:.95}
.btn:active{transform:translateY(1px)}
.btn-full{width:100%}
.blue{background:var(--blue)} .green{background:var(--green)} .red{background:var(--red)} .yellow{background:var(--yellow);color:#111} .gray{background:#e9eef8;color:#111}

/* Calculator result */
.result{background:#f4f8ff;border:1px dashed #dbe5ff;color:#0b2a66;border-radius:12px;padding:10px 12px;font-weight:800;text-align:center}

/* Lists */
.controls{display:grid;grid-template-columns:1fr 120px 120px;gap:8px;margin-bottom:10px}
@media(max-width:420px){.controls{grid-template-columns:1fr 1fr;}.controls .only-wide{grid-column:1/-1}}
.list{list-style:none;margin:6px 0 0;padding:0}
.item{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;padding:10px 0;border-bottom:1px solid var(--line)}
.item .meta{display:flex;align-items:center;gap:8px}
.badge{font-size:11px;border-radius:999px;padding:3px 8px;font-weight:800}
.b-green{background:#dffbe7;color:#0f5f32} .b-red{background:#ffe4e4;color:#8f1d1d}
.price{white-space:nowrap;font-weight:800}
.actions{display:flex;gap:6px}
.icon-btn{border:none;background:#eef2ff;color:#0b2a66;border-radius:10px;padding:8px;cursor:pointer}
.icon-btn.danger{background:#ffe5e5;color:#7d1b1b}
.icon-btn.secondary{background:#eaf9ef;color:#124d2a}

/* Undo snackbar */
.snack{position:fixed;left:50%;bottom:80px;transform:translateX(-50%);background:#101828;color:#fff;padding:12px 16px;border-radius:12px;box-shadow:0 18px 40px rgba(0,0,0,.3);display:flex;align-items:center;gap:10px;z-index:2000}
.snack button{background:#fff;color:#111;border:none;border-radius:10px;padding:6px 10px;font-weight:800;cursor:pointer}

/* Stats */
.stat-legend{display:flex;align-items:center;justify-content:center;gap:12px;margin:6px 0 10px}
.dot{width:12px;height:12px;border-radius:50%}
.dot.green{background:var(--green)} .dot.red{background:var(--red)}
canvas{width:100%;height:auto;border-radius:12px;background:#ffffff08}

/* Goals */
.progress{height:12px;background:#e8ecff;border-radius:999px;overflow:hidden}
.progress .bar{height:100%;background:linear-gradient(135deg,var(--green),#66e3a0);width:0%}

/* Modal */
.modal{position:fixed;inset:0;background:var(--overlay);display:flex;align-items:center;justify-content:center;z-index:1500;padding:16px}
.modal-content{background:var(--card);border-radius:18px;box-shadow:var(--shadow);padding:16px;max-width:540px;width:100%}
.modal-actions{display:flex;gap:8px;margin-top:10px}
textarea.code{height:160px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

/* Footer */
footer{color:var(--muted);text-align:center;font-size:12px;margin-top:8px}
</style>
</head>
<body>

<!-- WELCOME -->
<div id="welcomeScreen" class="container">
  <div class="welcome-logo">‚è∞</div>
  <h1 class="welcome-title">Munka√≥ra</h1>
  <p class="welcome-subtitle">Tudd meg, h√°ny munka√≥r√°dba ker√ºlnek a dolgok, √©s hozz okosabb d√∂nt√©seket!<br><span class="pill">+ Ap√°dhelyett Any√°d üòè</span></p>
  <button class="welcome-btn" id="startBtn" aria-label="Kezdj√ºk">Kezdj√ºk! üöÄ</button>
</div>

<!-- PROFILE SETUP -->
<div id="profileSetupScreen" class="container hidden" aria-live="polite">
  <div class="card">
    <h2>√Åll√≠tsd be a profilod</h2>
    <p class="center" style="margin:-4px 0 10px;color:var(--muted)">Add meg az adataidat a pontos sz√°m√≠t√°shoz</p>
    <label for="setupName">Becen√©v</label>
    <input id="setupName" type="text" placeholder="Add meg a beceneved" />
    <label for="setupAge">Kor</label>
    <input id="setupAge" type="number" min="1" placeholder="Add meg a korod" />
    <label for="setupSalary">Nett√≥ havi fizet√©s (Ft)</label>
    <input id="setupSalary" type="number" min="1" placeholder="pl. 450000" />
    <label for="setupHours">Heti munka√≥r√°k</label>
    <input id="setupHours" type="number" min="1" placeholder="pl. 40" />
    <div class="row">
      <button class="btn blue" id="saveSetupProfile">Folytat√°s ‚Üí</button>
      <button class="btn gray" id="backToWelcome">Vissza</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appScreen" class="container hidden">
  <div class="app-header">
    <div class="brand">
      <h1>Munka√≥ra</h1>
      <small>Tudd, h√°ny √≥r√°t dolgozol a v√°gyaid√©rt.</small>
    </div>
    <div class="header-right">
      <div class="switch"><input id="themeToggle" class="toggle" type="checkbox" aria-label="S√∂t√©t m√≥d kapcsol√≥" /></div>
      <button class="settings-btn" id="openSettings" title="Be√°ll√≠t√°sok">‚öôÔ∏è</button>
      <div class="profile-icon" id="profileIcon" title="Profil">üë§</div>
    </div>
  </div>

  <nav class="tabs" role="tablist">
    <button class="tab active" data-view="calc" role="tab" aria-selected="true">Kalkul√°tor</button>
    <button class="tab" data-view="results" role="tab">Eredm√©nyek</button>
    <button class="tab" data-view="stats" role="tab">Statisztika</button>
    <button class="tab" data-view="goals" role="tab">C√©lok</button>
  </nav>

  <!-- CALCULATOR -->
  <section id="view-calc" class="card" role="region" aria-label="Kalkul√°tor">
    <h2>Kalkul√°tor</h2>
    <p class="center" id="hello">Szia! Kezdj√ºk egy t√©tellel.</p>
    <label for="productName">Term√©k neve</label>
    <input id="productName" type="text" placeholder="pl. AirPods Pro" />
    <label for="productPrice">Term√©k √°ra (Ft)</label>
    <input id="productPrice" type="number" min="1" placeholder="pl. 79990" />
    <button class="btn yellow btn-full" id="calculateBtn">Kisz√°molom</button>
    <div id="calcResult" class="hidden" style="margin-top:14px">
      <p class="result" id="workHoursText"></p>
      <p class="center" id="hourlyHint" style="color:var(--muted);margin:8px 0 12px"></p>
      <div class="row">
        <button class="btn green" id="saveBtn">Megsp√≥rolom üíö</button>
        <button class="btn red" id="buyBtn">Megveszem üí∏</button>
      </div>
    </div>
  </section>

  <!-- RESULTS -->
  <section id="view-results" class="card hidden" role="region" aria-label="Eredm√©nyek">
    <h2>Eredm√©nyek</h2>
    <div class="sum" style="margin-bottom:8px">
      <div><span>üíö Megsp√≥rolt √∂sszeg</span><b id="totalSaved">0 Ft</b></div>
      <div><span>üí∏ Elk√∂lt√∂tt √∂sszeg</span><b id="totalSpent">0 Ft</b></div>
      <div><span class="muted">üßÆ Nett√≥</span><b id="net">0 Ft</b></div>
    </div>

    <div class="controls">
      <input id="searchBox" type="search" placeholder="Keres√©s n√©v szerint‚Ä¶" aria-label="Keres√©s" />
      <select id="filterSelect" class="only-wide" aria-label="Sz≈±r√©s">
        <option value="all">√ñsszes</option>
        <option value="saved">Csak sp√≥rolt</option>
        <option value="spent">Csak megvett</option>
      </select>
      <select id="sortSelect" class="only-wide" aria-label="Rendez√©s">
        <option value="date_desc">D√°tum ‚Üì</option>
        <option value="date_asc">D√°tum ‚Üë</option>
        <option value="price_desc">√ñsszeg ‚Üì</option>
        <option value="price_asc">√ñsszeg ‚Üë</option>
        <option value="name_asc">N√©v A‚ÄìZ</option>
        <option value="name_desc">N√©v Z‚ÄìA</option>
      </select>
    </div>

    <ul class="list" id="itemList" aria-live="polite"></ul>

    <div class="row" style="margin-top:12px">
      <button class="btn gray" id="clearAll">Lista √ºr√≠t√©se</button>
      <button class="btn blue" data-view="calc">√öj t√©tel</button>
    </div>
  </section>

  <!-- STATS -->
  <section id="view-stats" class="card hidden" role="region" aria-label="Statisztika">
    <h2>Statisztika</h2>
    <div class="stat-legend"><span class="dot green"></span><span class="hint">Megsp√≥rolt</span><span class="dot red"></span><span class="hint">Megvett</span></div>
    <canvas id="statsCanvas" width="680" height="360"></canvas>
    <p class="center hint">Havi bont√°s + mozg√≥√°tlag (Ft)</p>
  </section>

  <!-- GOALS -->
  <section id="view-goals" class="card hidden" role="region" aria-label="C√©lok">
    <h2>C√©lok</h2>
    <label for="monthlyCap">Havi k√∂lt√©si keret (Ft)</label>
    <input id="monthlyCap" type="number" min="0" placeholder="pl. 100000" />
    <label for="savingGoal">Sp√≥rol√°si c√©l (Ft)</label>
    <input id="savingGoal" type="number" min="0" placeholder="pl. 300000" />
    <div class="row">
      <button class="btn blue" id="saveGoals">C√©lok ment√©se</button>
      <button class="btn gray" id="resetGoals">C√©lok t√∂rl√©se</button>
    </div>
    <div style="margin-top:14px">
      <div class="center" style="margin-bottom:8px"><b>Sp√≥rol√°si c√©l teljes√ºl√©se</b> ‚Äî <span id="goalProgressLabel">0%</span></div>
      <div class="progress"><div class="bar" id="goalProgressBar" style="width:0%"></div></div>
    </div>
  </section>

  <footer>¬© 2025 Munka√≥ra ‚Ä¢ Ap√°dhelyett Any√°d üòè</footer>
  <div id="coach" class="hidden"></div>
  <div id="snack" class="hidden"></div>
</div>

<!-- PROFILE MODAL -->
<div id="profileModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Profil szerkeszt√©se">
  <div class="modal-content">
    <h2>Profil szerkeszt√©se</h2>
    <label for="editName">Becen√©v</label>
    <input id="editName" type="text" />
    <label for="editAge">Kor</label>
    <input id="editAge" type="number" min="1" />
    <label for="editSalary">Nett√≥ havi fizet√©s (Ft)</label>
    <input id="editSalary" type="number" min="1" />
    <label for="editHours">Heti munka√≥r√°k</label>
    <input id="editHours" type="number" min="1" />
    <div class="modal-actions">
      <button class="btn blue" id="saveEditProfile">Ment√©s</button>
      <button class="btn gray" id="closeModal">M√©gse</button>
      <button class="btn red" id="deleteProfile">Profil t√∂rl√©se</button>
    </div>
  </div>
</div>

<!-- SETTINGS MODAL -->
<div id="settingsModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Be√°ll√≠t√°sok">
  <div class="modal-content">
    <h2>Be√°ll√≠t√°sok</h2>
    <div class="row">
      <button class="btn blue" id="exportData">Export JSON</button>
      <button class="btn green" id="importData">Import JSON</button>
      <button class="btn red" id="resetAll">Teljes reset</button>
    </div>
    <textarea id="jsonArea" class="code" placeholder='Itt jelenik meg az export√°lt JSON, vagy ide illeszd be az importot'></textarea>
    <div class="modal-actions">
      <button class="btn gray" id="closeSettings">Bez√°r</button>
    </div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const esc=s=>(s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
const fmtFt=v=>new Intl.NumberFormat("hu-HU",{style:"currency",currency:"HUF",maximumFractionDigits:0}).format(Number(v||0));
const now=()=>Date.now();
const MONTHS=["01","02","03","04","05","06","07","08","09","10","11","12"];
const schemaVersion=2;

const Data={
  get:(k)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):null}catch(e){return null}},
  set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v));return true}catch(e){return false}},
  del:(k)=>localStorage.removeItem(k),
  migrate(){
    const v=Data.get("__schema")||1;
    if(v<2){
      ["saved","spent"].forEach(key=>{
        const arr=Data.get(key)||[];
        arr.forEach(it=>{ if(!it.at) it.at=now(); if(it.name && typeof it.name!=="string") it.name=String(it.name); });
        Data.set(key,arr);
      });
      Data.set("__schema",2);
    }
  }
};

const API={
  profile:()=>Data.get("profile"),
  saveProfile:(p)=>{Data.set("profile",p)},
  deleteProfile:()=>{["profile","saved","spent","goals"].forEach(Data.del)},
  list:(type)=>Data.get(type)||[],
  add:(type,item)=>{const list=Data.get(type)||[];list.unshift({...item,at:now(),type});Data.set(type,list)},
  setList:(type,list)=>Data.set(type,list),
  clearLists:()=>{Data.set("saved",[]);Data.set("spent",[])},
  theme:()=>Data.get("theme")||"light",
  setTheme:(t)=>Data.set("theme",t),
  goals:()=>Data.get("goals")||{monthlyCap:0,savingGoal:0},
  saveGoals:(g)=>Data.set("goals",g),
  exportAll:()=>{
    return {
      __schema:schemaVersion,
      profile:API.profile(),
      saved:API.list("saved"),
      spent:API.list("spent"),
      goals:API.goals(),
      theme:API.theme()
    };
  },
  importAll:(obj)=>{
    if(!obj||typeof obj!=="object") throw new Error("√ârv√©nytelen JSON");
    if(obj.__schema && obj.__schema>schemaVersion) throw new Error("√öjabb s√©m√°j√∫ adat ‚Äì friss√≠tsd az appot!");
    if(obj.profile) Data.set("profile",obj.profile);
    if(Array.isArray(obj.saved)) Data.set("saved",obj.saved);
    if(Array.isArray(obj.spent)) Data.set("spent",obj.spent);
    if(obj.goals) Data.set("goals",obj.goals);
    if(obj.theme) Data.set("theme",obj.theme);
    Data.set("__schema",schemaVersion);
  }
};

const COACH=[
"Ejnye, ez√©rt most sokat fogsz dolgozni. üò¨","A p√©nzt√°rc√°d halk s√≠r√°st hallatott. üí∏","A j√∂v≈ëbeli √©ned most cs√≥v√°lja a fej√©t.",
"Ha boldogg√° tesz, ok√© ‚Äì de sok √≥r√°dba ker√ºl.","Ez m√°r a 'dr√°ga, de kell' kateg√≥ria? ü§®","A banksz√°ml√°d szabads√°gra ment.",
"10 √≥r√°n t√∫l? Any√°d felh√≠vna. ü´®","Legk√∂zelebb √≠rd be: 'gondolkozzak m√©g'.","A racionalit√°s most eb√©del. üçΩÔ∏è","Legal√°bb sz√©p lesz. Rem√©lj√ºk.",
"Ez egy hossz√∫ m≈±szak √°ra. ‚è≥","Instant dopamin, tart√≥s m√≠nusz. ‚ö°Ô∏è","A lelkiismereted most offline.","K√°v√© helyett most dolgozol √©rte m√©g p√°rat.",
"Nem musz√°j, de megtetted. üòÖ","A matek nem tapsol most. üßÆ","Ezen most a p√©nz√ºgyi coach felszisszent.","Ok√©, de haszn√°ld is naponta!",
"A j√≥zan √©sz most AFK. üì¥","Ha meghozn√°d √∫jra ezt a d√∂nt√©st? Biztos?","Egy t√©tel, k√©t s√≥haj. üòÆ‚Äçüí®","Ez a 'sz√≠v d√∂nt√∂tt' v√°s√°rl√°s.",
"Minimum egy h√©tv√©ge ment r√°.","Nem rossz, csak‚Ä¶ dr√°ga.","Ha akci√≥s volt, kicsit kev√©sb√© f√°j.","A 'majd visszateszem' gomb letiltva? üòè",
"Ezt a d√∂nt√©st screenshotolom a tanmes√©hez. üì∏","Kis l√©p√©s a t√°rgy fel√©, nagy l√©p√©s a m√≠nuszba.","√ârzed azt a kis b√∂k√©st? Az a bankk√°rtya. üí≥",
"Na‚Ä¶ legal√°bb sztori lesz. üìñ","A sp√≥rol√°s most sz√ºnetel. üßò","Ha ezt megsp√≥roltad volna‚Ä¶","Ez m√°r 'luxus-szag√∫' d√∂nt√©s. üíé",
"A j√∂v≈ë heti eb√©ded integet. üçù","10+ √≥ra? Ez m√°r szerelem.","Tudod, hogy ez√©rt t√∫l√≥r√°zol majd?","A k√∂lts√©gvet√©sed most k√©r egy √∂lel√©st.",
"Ez a v√°s√°rl√°s besz√©lget√©st √©rdemel.","A m√©rleg: √∂r√∂m + b≈±ntudat = egyenleg?","Az √©sz helyett a szem d√∂nt√∂tt. üëÄ","Valaki most nagyon boldog (a keresked≈ë).",
"Rem√©lj√ºk legal√°bb tart√≥s.","Ha ez motiv√°l a munk√°ra ‚Äì rendben. üí™","P√©nz√ºgyi edz√©s: ma farizom + p√©nzt√°rca.","Ezt a 'sz√ºks√©ges' sz√≥t feszegetj√ºk.",
"A sp√≥rol√°sod most leveg≈ët vesz.","Kedves, de k√∂lts√©ges.","A 'csak megn√©zem' ut√°n ez lett. üõí","√ân sz√≥ltam volna‚Ä¶ ha k√©rdezel. üòâ",
"Egy t√°rgy, sok √≥ra. J√≥ csere?","A fej sz√°mol, a sz√≠v v√°s√°rol.","Ha ezt b√©rben m√©rn√©nk, sok lenne.","Majd amikor j√∂n a rezsi, eml√©kezz. üßæ",
"Ez m√°r 'feln≈ëtt d√∂nt√©s' ‚Äì √°ra van.","A bankod is l√°tta ezt, ugye? üëÄ","Ha ez √∂r√∂m√∂t hoz, ok√© ‚Äì de sokba ker√ºlt.","Instant j√≥ √©rz√©s, k√©sleltetett f√°j√°s.",
"Nem baj, tanul√≥p√©nz. Dr√°ga tanul√≥p√©nz.","Anyai s√≥haj: *hosszan*. üòÆ‚Äçüí®","Ha ezt eladn√°d k√©s≈ëbb‚Ä¶ k√©rd√©ses.","Ez m√°r 'j√≥, de musz√°j volt?' kateg√≥ria.",
"K√∂vetkez≈ëre √≠rj list√°t. üìù","A hat√°rid≈ëk is integetnek most. ‚è∞","A sp√≥rol√°sod megbicsaklott.","A p√©nzed kicsit elszaladt k√°v√©zni. ‚òï",
"Egy 'majd legk√∂zelebb' gomb hi√°nyzott.","Ezt a d√∂nt√©st a j√∂v≈ëbeli te √©rt√©kelni fogja? ü§î","Tarts egy 24 √≥r√°s szab√°lyt legk√∂zelebb.",
"Most m√°r legal√°bb motiv√°lt vagy dolgozni. üòÖ","A k√∂lts√©gvet√©sed k√©r egy meetinget. üìä","Ez k√©rem pr√©selt munka√≥r√°kb√≥l k√©sz√ºlt. üîß",
"A hitelk√°rty√°d halkan remeg.","Ez az √©lm√©ny rem√©lj√ºk nem m√∫l√≥.","Ha ezt egyszer≈±en 'kellett' ‚Äì j√≥ van.","Az √©sz: 'nem', a v√°gy: 'igen'.",
"A p√©nz√ºgyi hat√°r most kicsit cs√∫szott.","A 'sp√≥rolom' gomb is ott volt √°m.","Kicsit t√∂bb lett, mint 'apr√≥'.","Legal√°bb kipip√°lhatsz valamit a list√°n.",
"Gondold √°t: 10+ √≥ra = ez a t√°rgy.","A kompromisszumok dr√°g√°k.","A minimalizmus most elfordult. üßò‚Äç‚ôÇÔ∏è","Na j√≥l van, de most sp√≥rol√≥s h√©t j√∂n!",
"A p√©nz√ºgyi √©n-ed most s√≠r.","Ha ez hobbi: ok√©. Ha h√≥bort: k√©tszer gondold √°t.","A 'mi√©rt' er≈ësebb volt, mint a 'mennyi'.",
"Egy kis b≈±ntudat, egy nagy doboz. üì¶","K√∂zelebb ker√ºlt√©l hozz√° ‚Äì a banksz√°mla t√°volabb.","Az √°r-√©rt√©k ar√°ny most vitatott.",
"Ez a 'meg√©rdemlem' pillanat?","Jutalomv√°s√°rl√°s? Akkor hajr√° ‚Äì ritk√°n.","A t√ºrelem gyakran olcs√≥bb. ‚è≥","A 'most azonnal kell' a legdr√°g√°bb.",
"Ha a munk√°d boldogg√° tesz ‚Äì megdolgozt√°l √©rte.","A j√∂v≈ëbeli sz√°ml√°k nem felejtenek.","A keret csipogott. üìâ","A d√∂nt√©s megvan ‚Äì most haszn√°ld is, sokat!",
"Minimum 10 √≥ra ‚Äì maximum √∂r√∂m?","Ha ez inspir√°l: nyert√©l. Ha nem: tanult√°l.","Ok√©, de a k√∂vetkez≈ë legyen 'Megsp√≥rolom'.",
"A bankod eddig b√≠rta nevet√©s n√©lk√ºl. üò¨","Minden rendben ‚Äì csak most kicsit dr√°ga lett.","A sp√≥rol√°sod most visszasz√°mol.",
"Ezt m√©g Any√°d is megk√©rdezn√©: kellett?","Z√°rjuk le: haszn√°ld eg√©szs√©ggel, okosan. ‚úÖ",
"Ez m√°r borderline luxus. üíé","Egy h√≥napnyi k√°v√© √°ra ment el. ‚òï","Ha holnap is √≠gy √©rzed, tartsd meg.",
"√År/√∂r√∂m ar√°ny? Gondold √°t.","Kicsit sok lett a munka√≥ra a kos√°rban.","A j√∂v≈ë heti c√©ljaid is sz√°m√≠tanak.","Lehetett volna 'Megsp√≥rolom' is‚Ä¶ üòâ",
"Ez nem csak p√©nz, id≈ë is.","Ha kihagyod, mit vesztesz?","√âlm√©ny vagy t√°rgy?","Ha elromlik, mennyire f√°j?","Egyszeri √∂r√∂m vs tart√≥s √©rt√©k.",
"√Ållj meg egy pillanatra, vegy√©l leveg≈ët.","Ha aj√°nd√©k magadnak ‚Äì legyen tudatos.","Ezt most csukl√≥gyakorlatb√≥l vetted.",
"Nem rossz d√∂nt√©s ‚Äì csak dr√°ga.","Haszn√°lni fogod heti 3√ó?","Tanul√≥p√©nz vagy befektet√©s?","A h≈±t≈ëd √ºzeni: hello, rezsi! üßæ",
"Ugye nem hitelre ment?","Ha figyelsz, a k√∂vetkez≈ë m√°r sp√≥rolt lesz.","K√∂lts, de okosan ‚Äì √©s ritk√°n nagyot.",
"Ha nem okoz stresszt: ok√©.","Ha igen: v√°lts 'Megsp√≥rolom'-ra legk√∂zelebb.","√ân sz√≥ltam. üòè","Z√°rjuk le: √©lvezd, de tanulj bel≈ële."
];

const UI={
  setTheme(theme){document.documentElement.setAttribute("data-theme",theme);$("#themeToggle").checked=(theme==="dark");API.setTheme(theme)},
  snack(msg,withUndo,undoFn){
    const s=$("#snack"); s.className="snack"; s.innerHTML="";
    const span=document.createElement("span"); span.textContent=msg; s.appendChild(span);
    if(withUndo){
      const b=document.createElement("button"); b.textContent="Visszavon√°s"; b.addEventListener("click",()=>{undoFn&&undoFn(); s.classList.add("hidden");}); s.appendChild(b);
    }
    setTimeout(()=>s.classList.add("hidden"),3500);
  },
  coach(msg){const b=$("#coach"); b.className="bubble"; b.textContent="Ap√°dhelyett Any√°d: "+msg; setTimeout(()=>{b.classList.add("hidden")},2400)}
};

const App={
  state:{view:"calc",lastAction:null,search:"",filter:"all",sort:"date_desc"},
  init(){
    Data.migrate();
    this.bindWelcome();
    this.bindProfileSetup();
    this.bindTheme();
    this.bindTabs();
    this.bindCalculator();
    this.bindResults();
    this.bindGoals();
    this.bindProfileModal();
    this.bindSettings();
    this.bindShortcuts();
    const p=API.profile();
    if(p){$("#welcomeScreen").classList.add("hidden");$("#appScreen").classList.remove("hidden");this.updateProfileIcon();this.syncCalcHello();}
    UI.setTheme(API.theme());
    this.setView(p?"calc":"calc"); // landing view
    this.renderResults();
    this.updateGoalsUI();
  },
  bindWelcome(){
    $("#startBtn").addEventListener("click",()=>{$("#welcomeScreen").classList.add("hidden");$("#profileSetupScreen").classList.remove("hidden")});
    $("#backToWelcome").addEventListener("click",()=>{$("#profileSetupScreen").classList.add("hidden");$("#welcomeScreen").classList.remove("hidden")});
  },
  bindProfileSetup(){
    $("#saveSetupProfile").addEventListener("click",()=>{
      const profile={
        name:$("#setupName").value.trim(),
        age:Number($("#setupAge").value),
        salary:Number($("#setupSalary").value),
        hours:Number($("#setupHours").value)
      };
      if(!profile.name||!profile.age||!profile.salary||!profile.hours){alert("T√∂lts ki minden mez≈ët!");return;}
      API.saveProfile(profile);
      $("#profileSetupScreen").classList.add("hidden");
      $("#appScreen").classList.remove("hidden");
      this.updateProfileIcon(); this.syncCalcHello();
    });
  },
  bindTheme(){
    const t=$("#themeToggle"); t.addEventListener("change",()=>UI.setTheme(t.checked?"dark":"light")); UI.setTheme(API.theme());
  },
  bindTabs(){
    $$(".tab").forEach(tab=>tab.addEventListener("click",()=>this.setView(tab.dataset.view)));
    $$('[data-view="calc"]').forEach(b=>b.addEventListener("click",()=>this.setView("calc")));
  },
  setView(v){
    this.state.view=v;
    $$(".tab").forEach(t=>t.classList.toggle("active",t.dataset.view===v));
    $("#view-calc").classList.toggle("hidden",v!=="calc");
    $("#view-results").classList.toggle("hidden",v!=="results");
    $("#view-stats").classList.toggle("hidden",v!=="stats");
    $("#view-goals").classList.toggle("hidden",v!=="goals");
    if(v==="results") this.renderResults();
    if(v==="stats") this.drawStats();
    if(v==="calc") this.syncCalcHello();
    window.scrollTo({top:0,behavior:"smooth"});
  },
  bindCalculator(){
    const calc=()=> {
      const p=API.profile(); if(!p){alert("El≈ëbb t√∂ltsd ki a profilod!");return;}
      const name=$("#productName").value.trim(); const price=Number($("#productPrice").value);
      if(!name||!price||price<=0){alert("Add meg a term√©k nev√©t √©s √°r√°t!");return;}
      const hourly=p.salary/(p.hours*4); const hours=price/hourly;
      $("#workHoursText").textContent=`Kb. ${hours.toFixed(1)} munka√≥r√°dba ker√ºlne (${fmtFt(price)}).`;
      $("#hourlyHint").textContent=`Jelenlegi √≥rab√©red ~ ${fmtFt(hourly)}/√≥ra`;
      const r=$("#calcResult"); r.dataset.name=name; r.dataset.price=String(price); r.dataset.hours=String(hours); r.classList.remove("hidden");
    };
    $("#calculateBtn").addEventListener("click",calc);
    const commit=(type)=>{
      const r=$("#calcResult"); const name=r.dataset.name; const price=Number(r.dataset.price); const hours=Number(r.dataset.hours);
      if(!name||!price){alert("El≈ëbb sz√°molj!");return;}
      API.add(type,{name,price,hours});
      this.state.lastAction={type,entry:{name,price,hours,at:now()}};
      $("#productName").value=""; $("#productPrice").value=""; r.classList.add("hidden");
      if(type==="spent" && hours>10){ UI.coach(COACH[Math.floor(Math.random()*COACH.length)]); setTimeout(()=>this.setView("results"),2500); }
      else { this.setView("results"); }
    };
    $("#saveBtn").addEventListener("click",()=>commit("saved"));
    $("#buyBtn").addEventListener("click",()=>commit("spent"));
  },
  bindResults(){
    $("#clearAll").addEventListener("click",()=>{
      if(!confirm("Biztos √ºr√≠ted a list√°t?")) return;
      const backup={saved:API.list("saved"),spent:API.list("spent")};
      API.clearLists(); this.renderResults(); this.drawStats();
      UI.snack("Lista t√∂r√∂lve.",true,()=>{API.setList("saved",backup.saved);API.setList("spent",backup.spent);this.renderResults();this.drawStats();});
    });
    $("#searchBox").addEventListener("input",(e)=>{this.state.search=e.target.value.trim().toLowerCase(); this.renderResults();});
    $("#filterSelect").addEventListener("change",(e)=>{this.state.filter=e.target.value; this.renderResults();});
    $("#sortSelect").addEventListener("change",(e)=>{this.state.sort=e.target.value; this.renderResults();});
  },
  itemsFilteredSorted(){
    const q=this.state.search; const filter=this.state.filter; const sort=this.state.sort;
    let items=[...API.list("saved"),...API.list("spent")];
    if(filter!=="all") items=items.filter(i=>i.type===filter);
    if(q) items=items.filter(i=> (i.name||"").toLowerCase().includes(q));
    items.sort((a,b)=>{
      if(sort==="date_desc") return (b.at||0)-(a.at||0);
      if(sort==="date_asc") return (a.at||0)-(b.at||0);
      if(sort==="price_desc") return (b.price||0)-(a.price||0);
      if(sort==="price_asc") return (a.price||0)-(b.price||0);
      if(sort==="name_asc") return (a.name||"").localeCompare(b.name||"");
      if(sort==="name_desc") return (b.name||"").localeCompare(a.name||"");
      return 0;
    });
    return items;
  },
  renderResults(){
    const saved=API.list("saved"), spent=API.list("spent");
    const totalSaved=saved.reduce((s,i)=>s+Number(i.price||0),0);
    const totalSpent=spent.reduce((s,i)=>s+Number(i.price||0),0);
    $("#totalSaved").textContent=fmtFt(totalSaved);
    $("#totalSpent").textContent=fmtFt(totalSpent);
    $("#net").textContent=fmtFt(totalSaved-totalSpent);

    const items=this.itemsFilteredSorted();
    const ul=$("#itemList"); ul.innerHTML="";
    items.forEach((it,idx)=>{
      const li=document.createElement("li"); li.className="item";
      const meta=document.createElement("div"); meta.className="meta";
      const badge=document.createElement("span"); badge.className="badge "+(it.type==="saved"?"b-green":"b-red"); badge.textContent=(it.type==="saved"?"sp√≥rolt":"vett");
      const name=document.createElement("span"); name.innerHTML=esc(it.name);
      const price=document.createElement("span"); price.className="price"; price.textContent=fmtFt(it.price);
      meta.appendChild(badge); meta.appendChild(name); li.appendChild(meta); li.appendChild(price);

      const actions=document.createElement("div"); actions.className="actions";
      const editBtn=document.createElement("button"); editBtn.className="icon-btn secondary"; editBtn.title="Szerkeszt√©s"; editBtn.textContent="‚úèÔ∏è";
      const delBtn=document.createElement("button"); delBtn.className="icon-btn danger"; delBtn.title="T√∂rl√©s"; delBtn.textContent="üóëÔ∏è";
      actions.appendChild(editBtn); actions.appendChild(delBtn); li.appendChild(actions);
      ul.appendChild(li);

      editBtn.addEventListener("click",()=>this.editItem(it));
      delBtn.addEventListener("click",()=>this.deleteItem(it));
    });
  },
  editItem(item){
    const newName=prompt("√öj n√©v:",item.name||""); if(newName===null) return;
    let newPrice=prompt("√öj √°r (Ft):",String(item.price||0)); if(newPrice===null) return;
    newPrice=Number(newPrice); if(!newName.trim()||!newPrice||newPrice<=0){alert("√ârv√©nytelen √©rt√©k.");return;}
    const list=API.list(item.type).map(it=>{
      if(it.at===item.at && it.name===item.name && it.price===item.price){return {...it,name:newName.trim(),price:newPrice}}
      return it;
    });
    API.setList(item.type,list);
    this.renderResults(); this.drawStats();
    UI.snack("T√©tel friss√≠tve.");
  },
  deleteItem(item){
    const list=API.list(item.type);
    const idx=list.findIndex(it=>it.at===item.at && it.name===item.name && it.price===item.price);
    if(idx===-1) return;
    const removed=list.splice(idx,1)[0]; API.setList(item.type,list);
    this.renderResults(); this.drawStats();
    UI.snack("T√©tel t√∂r√∂lve.",true,()=>{ list.splice(idx,0,removed); API.setList(item.type,list); this.renderResults(); this.drawStats(); });
  },
  drawStats(){
    const cvs=$("#statsCanvas"); const ctx=cvs.getContext("2d");
    ctx.clearRect(0,0,cvs.width,cvs.height);
    const monthKey=ts=>{const d=new Date(ts);return d.getFullYear()+"-"+MONTHS[d.getMonth()]};
    const map=new Map();
    API.list("saved").forEach(it=>{const k=monthKey(it.at||now()); const o=map.get(k)||{saved:0,spent:0}; o.saved+=Number(it.price)||0; map.set(k,o);});
    API.list("spent").forEach(it=>{const k=monthKey(it.at||now()); const o=map.get(k)||{saved:0,spent:0}; o.spent+=Number(it.price)||0; map.set(k,o);});
    const arr=[...map.entries()].sort((a,b)=>a[0]>b[0]?1:-1).slice(-8);
    const labels=arr.map(x=>x[0]), sData=arr.map(x=>x[1].saved), pData=arr.map(x=>x[1].spent);
    const P={l:48,r:22,t:16,b:40}, W=cvs.width-P.l-P.r, H=cvs.height-P.t-P.b;
    const style=getComputedStyle(document.documentElement);
    ctx.strokeStyle=style.getPropertyValue("--line"); ctx.lineWidth=1;
    ctx.beginPath(); ctx.moveTo(P.l,P.t); ctx.lineTo(P.l,P.t+H); ctx.lineTo(P.l+W,P.t+H); ctx.stroke();
    const max=Math.max(1000,...sData,...pData); const y=v=>P.t+H-(v/max)*H; const unit=W/Math.max(1,labels.length); const bar=unit/2.4;
    for(let i=0;i<labels.length;i++){
      const x0=P.l+i*unit+8;
      ctx.fillStyle=style.getPropertyValue("--green"); ctx.fillRect(x0, y(sData[i]), bar, (P.t+H)-y(sData[i]));
      ctx.fillStyle=style.getPropertyValue("--red"); ctx.fillRect(x0+bar+6, y(pData[i]), bar, (P.t+H)-y(pData[i]));
      ctx.fillStyle=style.getPropertyValue("--muted"); ctx.font="12px system-ui"; ctx.textAlign="center";
      ctx.fillText(labels[i], x0+bar/2+3, P.t+H+16);
    }
    // moving average (spent)
    if(pData.length>=3){
      const avg=[]; for(let i=0;i<pData.length;i++){ const a=pData.slice(Math.max(0,i-2),i+1); avg.push(a.reduce((s,v)=>s+v,0)/a.length); }
      ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle=style.getPropertyValue("--blue");
      for(let i=0;i<avg.length;i++){ const x=P.l+i*unit+bar; const yy=y(avg[i]); if(i===0) ctx.moveTo(x,yy); else ctx.lineTo(x,yy); }
      ctx.stroke();
    }
  },
  bindGoals(){
    $("#saveGoals").addEventListener("click",()=>{
      const g={monthlyCap:Number($("#monthlyCap").value)||0, savingGoal:Number($("#savingGoal").value)||0};
      API.saveGoals(g); this.updateGoalsUI(); UI.snack("C√©lok mentve.");
    });
    $("#resetGoals").addEventListener("click",()=>{API.saveGoals({monthlyCap:0,savingGoal:0}); $("#monthlyCap").value=""; $("#savingGoal").value=""; this.updateGoalsUI();});
  },
  updateGoalsUI(){
    const g=API.goals(); $("#monthlyCap").value=g.monthlyCap||""; $("#savingGoal").value=g.savingGoal||"";
    const totalSaved=(API.list("saved").reduce((s,i)=>s+Number(i.price||0),0)); const goal=g.savingGoal||0;
    const pct=goal>0?Math.min(100,Math.round((totalSaved/goal)*100)):0;
    $("#goalProgressBar").style.width=pct+"%"; $("#goalProgressLabel").textContent=pct+"%";
  },
  bindProfileModal(){
    $("#profileIcon").addEventListener("click",()=>{
      const p=API.profile()||{name:"",age:"",salary:"",hours:""};
      $("#editName").value=p.name||""; $("#editAge").value=p.age||""; $("#editSalary").value=p.salary||""; $("#editHours").value=p.hours||"";
      $("#profileModal").classList.remove("hidden");
    });
    $("#closeModal").addEventListener("click",()=>$("#profileModal").classList.add("hidden"));
    $("#saveEditProfile").addEventListener("click",()=>{
      const p={name:$("#editName").value.trim(),age:Number($("#editAge").value),salary:Number($("#editSalary").value),hours:Number($("#editHours").value)};
      if(!p.name||!p.age||!p.salary||!p.hours){alert("T√∂lts ki minden mez≈ët!");return;}
      API.saveProfile(p); $("#profileModal").classList.add("hidden"); this.updateProfileIcon(); this.syncCalcHello(); UI.snack("Profil friss√≠tve.");
    });
    $("#deleteProfile").addEventListener("click",()=>{
      if(!confirm("Biztos t√∂rl√∂d a profilodat √©s minden adatot?")) return;
      API.deleteProfile(); $("#profileModal").classList.add("hidden"); $("#appScreen").classList.add("hidden"); $("#welcomeScreen").classList.remove("hidden");
    });
  },
  bindSettings(){
    $("#openSettings").addEventListener("click",()=>{$("#settingsModal").classList.remove("hidden"); $("#jsonArea").value=""});
    $("#closeSettings").addEventListener("click",()=>$("#settingsModal").classList.add("hidden"));
    $("#exportData").addEventListener("click",()=>{
      const obj=API.exportAll(); $("#jsonArea").value=JSON.stringify(obj,null,2); UI.snack("Export k√©sz. M√°sold ki alul.");
    });
    $("#importData").addEventListener("click",()=>{
      try{ const obj=JSON.parse($("#jsonArea").value||"{}"); API.importAll(obj); this.renderResults(); this.drawStats(); this.updateGoalsUI(); this.syncCalcHello(); UI.snack("Import sikeres."); }
      catch(e){ alert("Import hiba: "+e.message); }
    });
    $("#resetAll").addEventListener("click",()=>{
      if(!confirm("Biztos teljes reset?")) return;
      API.deleteProfile(); UI.snack("Adatok t√∂r√∂lve."); location.reload();
    });
  },
  bindShortcuts(){
    document.addEventListener("keydown",(e)=>{
      if(e.key==="Escape"){ $("#profileModal").classList.add("hidden"); $("#settingsModal").classList.add("hidden"); }
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==="k"){ e.preventDefault(); if(this.state.view!=="results") this.setView("results"); $("#searchBox").focus(); }
    });
  },
  updateProfileIcon(){
    const p=API.profile(); if(!p||!p.name) return;
    $("#profileIcon").textContent=(p.name[0]||"üë§").toUpperCase();
  },
  syncCalcHello(){
    const p=API.profile(); const h=$("#hello");
    if(!p){ h.textContent="Szia! T√∂ltsd ki a profilod a pontos sz√°m√≠t√°shoz."; return; }
    h.innerHTML=`Szia <b>${esc(p.name)}</b>! N√©zz√ºk meg, h√°ny √≥r√°dba ker√ºlne.`;
  }
};

App.init();
</script>
</body>
</html>
